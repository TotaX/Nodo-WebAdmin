#!/bin/sh
# Modified By: Fernando F Nicola <nicolaff@gmail.com>
# To: Lugro-Mesh

PATH=/bin:/usr/bin:/sbin:/usr/sbin
######## This Environment ####
HOSTNAME=$(uci get "system.@system[0].hostname")
#HOSTNAME=NanoteX
WEB_USER=$(awk -F: '{print $2}' /etc/httpd.conf)
#WEB_USER=$(awk -F: '{print $2}' /home/nano/WWW_LUGRO/httpd.conf)
WMODE=$(uci get "wireless.wifi0.hwmode")
#WMODE="11g"
TS_STATUS=$(if [ $(uci get "nwnode.ts.status") != 0 ]; then echo Mode Enable; else echo Mode Disable;fi)
#TS_STATUS=Enable
TS_SHARE_RATE=$(uci get "nwnode.ts.share_rate")
#TS_SHARE_RATE=128

######## HEADER ###########

cat <<HEADER

$(cat header_html)

 <script type="text/javascript">
    var upgr={
	ajax:function(st)
	{
	    this.show('mostrar');
	},
	show:function(el)
	{
	    this.getID(el).style.display='';
	},
	getID:function(el)
	{
	    return document.getElementById(el);
	}
    }
 </script>
HEADER

#########################
####### MAIN VIEW #######
#########################
echo "<div id=\"box\">"

##### Boton para guardar cambios y reiniciar el nodo  #####
cat <<FORM_SAVE
<center>
        <form name="form1" action="./saveAndReboot.cgi" METHOD="POST" onsubmit="return upgr.ajax()">	
        <INPUT TYPE="submit" NAME="set" VALUE="Guardar y Reiniciar">
        </form>		
FORM_SAVE


cat <<BASIC_SETTINGS
<form name="frmBasicSettings" action="basicSettings.cgi" METHOD="GET">
			Root Password:<input type="text" name="rootPass" /><br>
			WPA2 Password:<input type="text" name="wpa2Pass" /><br>
			WEB User:<input type="text" name="webUser" /><b>Actual WebUser: </b>$WEB_USER<br>
			WEB Password:<input type="text" name="webPass" /><br>
			WiFiDog:<input type="text" name="wifiDog" /><br>
			Hostname:<input type="text" name="hostname" /> <b>Actual HostName:</b>$HOSTNAME<br>
			WirelessMode:
			 <SELECT name="wirelesMode">
				<OPTION selected label="ninguno" value="">Ninguno</OPTION>
				<OPTGROUP label="Please Select A Wireless Mode">
					<OPTION label="3.7.1" value="11b">11b</OPTION>
					<OPTION label="3.7" value="11g">11g</OPTION>
					<OPTION label="3.5" value="11bg">11bg</OPTION>
				</OPTGROUP>
			</SELECT> <b>Actual:</b>$WMODE<br>
			Traffic Shaping Status:<input type="checkbox" name="tsStatus" /> <b>Status:</b> $TS_STATUS<br>
			Traffic Shaping How Much:<input type="text" name="tsHowMuch" /> <b>Sharing:</b> $TS_SHARE_RATE<br>
			<INPUT TYPE="submit" NAME="set" VALUE="SaveBasicSettings">
</form>
BASIC_SETTINGS


echo "</div>"
######## FOOTER #########
cat <<FOOTER

$(cat footer_html)

FOOTER
